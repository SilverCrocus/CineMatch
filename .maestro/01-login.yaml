# Login Flow Test
# Tests the authentication flow for Cinematch mobile app
# Handles both logged-in and logged-out states

appId: com.cinematch.app
---

# Launch the app fresh to ensure clean state
- launchApp

# Check if already logged in (Home screen visible with new UI)
- runFlow:
    when:
      visible: "Welcome back.*"
    commands:
      # Already logged in - verify home screen elements
      - assertVisible: "New Session"
      - assertVisible: "Create Session"
      - assertVisible: "Join Session"
      # Verify tab bar exists by tapping Solo tab
      - tapOn:
          point: "50%,95%"
      - extendedWaitUntil:
          visible: "Solo Mode"
          timeout: 3000
      # Go back to Home tab
      - tapOn:
          point: "17%,95%"
      - extendedWaitUntil:
          visible: "Welcome back.*"
          timeout: 3000

# If on login screen, perform login
- runFlow:
    when:
      visible: "Sign in with Google"
    commands:
      - assertVisible: "Cinematch"
      - tapOn: "Sign in with Google"
      - extendedWaitUntil:
          visible: "Welcome back.*"
          timeout: 10000
      - assertVisible: "New Session"
      - assertVisible: "Join Session"
